---
import { Carousel } from 'astro-bootstrap';

interface Props {
  hero: {
    image: string;
    title: string;
    description: string;
    location: string;
    year: number;
  };
  slides: {
    image: string;
    text: string;
  }[];
}

const { hero, slides } = Astro.props;
const carouselId = 'essaySlideshow';

// Create all slides: hero first, then essay slides
const allSlides = [
  {
    image: hero.image,
    text: hero.description,
    title: hero.title,
    location: hero.location,
    year: hero.year,
    isHero: true,
  },
  ...slides.map(slide => ({
    image: slide.image,
    text: slide.text,
    isHero: false,
  })),
];
---

<div class="essay-slideshow-container" style="position: relative; width: 100%; height: 100vh; overflow: hidden;">
  <Carousel id={carouselId} fade interval={0} wrap={true}>
    <Carousel.Inner>
      {allSlides.map((slide, index) => (
        <Carousel.Item active={index === 0}>
          <div 
            class="slide-content"
            style="position: relative; width: 100%; height: 100vh; display: flex; align-items: center; justify-content: center; cursor: pointer; background-color: black;"
          >
            <!-- Content -->
            <div 
              class="slide-overlay"
              style="position: relative; z-index: 10; max-width: 90%; max-height: 90vh; width: 100%; color: white; display: flex; align-items: center; gap: 4rem; padding: 2rem;"
            >
              {slide.isHero ? (
                <div class="hero-slide-content" style="display: flex; align-items: center; gap: 4rem; width: 100%;">
                  <div style="flex: 1; min-width: 0;">
                    <img
                      src={slide.image}
                      alt={slide.title}
                      class="w-full h-auto object-contain rounded-lg"
                      style="max-height: 80vh; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);"
                    />
                  </div>
                  <div style="flex: 1; min-width: 0; display: flex; flex-direction: column; justify-content: center;">
                    <h1 class="text-4xl md:text-5xl font-light mb-6 tracking-wide uppercase">
                      {slide.title}
                    </h1>
                    <p class="text-xl md:text-2xl mb-6 leading-relaxed" style="font-weight: 300;">
                      {slide.text}
                    </p>
                    <div class="flex items-center gap-4 text-gray-300 text-sm">
                      <span class="uppercase tracking-[0.15em]">{slide.location}</span>
                      <span>â€”</span>
                      <span>{slide.year}</span>
                    </div>
                  </div>
                </div>
              ) : (
                <div class="essay-slide-content" style="display: flex; align-items: center; gap: 4rem; width: 100%;">
                  <div style="flex: 1; min-width: 0;">
                    <img
                      src={slide.image}
                      alt={slide.text}
                      class="w-full h-auto object-contain rounded-lg"
                      style="max-height: 80vh; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);"
                    />
                  </div>
                  <div style="flex: 1; min-width: 0; display: flex; flex-direction: column; justify-content: center;">
                    <p class="text-xl md:text-2xl" style="font-weight: 300; line-height: 1.75;">
                      {slide.text}
                    </p>
                  </div>
                </div>
              )}
            </div>
          </div>
        </Carousel.Item>
      ))}
    </Carousel.Inner>
    <Carousel.Controls id={carouselId} />
  </Carousel>
</div>

<script define:vars={{ carouselId }}>
  // Make slides clickable to advance
  const carouselElement = document.getElementById(carouselId);
  
  if (carouselElement) {
    // Click anywhere on the slide to advance (except carousel controls)
    carouselElement.addEventListener('click', (e) => {
      // Don't advance if clicking on carousel navigation controls
      if (e.target.closest('.carousel-control-prev') || 
          e.target.closest('.carousel-control-next')) {
        return;
      }
      
      const carousel = bootstrap.Carousel.getInstance(carouselElement);
      if (carousel) {
        carousel.next();
      }
    });
    
    // Also support keyboard navigation
    document.addEventListener('keydown', (e) => {
      if (e.key === 'ArrowRight' || e.key === ' ') {
        const carousel = bootstrap.Carousel.getInstance(carouselElement);
        if (carousel) {
          e.preventDefault();
          carousel.next();
        }
      } else if (e.key === 'ArrowLeft') {
        const carousel = bootstrap.Carousel.getInstance(carouselElement);
        if (carousel) {
          e.preventDefault();
          carousel.prev();
        }
      }
    });
  }
</script>
