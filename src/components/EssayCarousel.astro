---
import { Carousel } from 'astro-bootstrap';

interface Props {
  hero: {
    image: string;
    title: string;
    description: string;
    location: string;
    year: number;
  };
  slides: {
    image: string;
    text: string;
  }[];
}

const { hero, slides } = Astro.props;
const carouselId = 'essaySlideshow';

// Create all slides: hero first, then essay slides
const allSlides = [
  {
    image: hero.image,
    text: hero.description,
    title: hero.title,
    location: hero.location,
    year: hero.year,
    isHero: true,
  },
  ...slides.map(slide => ({
    image: slide.image,
    text: slide.text,
    isHero: false,
  })),
];
---

<div class="essay-slideshow-container" style="pointer-events: none;">
  <Carousel id={carouselId} fade interval={0} wrap={true}>
    <Carousel.Inner>
      {allSlides.map((slide, index) => (
        <Carousel.Item active={index === 0}>
          <div class="slide-content">
            <!-- Content -->
            <div class="slide-overlay" id="essay-content" style="pointer-events: auto;">
              {slide.isHero ? (
                <div class="hero-slide-content">
                  <div>
                    <img
                      src={slide.image}
                      alt={slide.title}
                      class="object-contain rounded-lg"
                    />
                  </div>
                  <div>
                    <h1 class="text-4xl md:text-5xl font-light mb-6 tracking-wide uppercase">
                      {slide.title}
                    </h1>
                    <p class="text-xl md:text-2xl mb-6 leading-relaxed">
                      {slide.text}
                    </p>
                    <div class="flex items-center gap-4 text-gray-300 text-sm">
                      <span class="uppercase tracking-[0.15em]">{slide.location}</span>
                      <span>â€”</span>
                      <span>{slide.year}</span>
                    </div>
                  </div>
                </div>
              ) : (
                <div class="essay-slide-content">
                  <div>
                    <img
                      src={slide.image}
                      alt={slide.text}
                      class="object-contain rounded-lg"
                    />
                  </div>
                  <div>
                    <p class="text-xl md:text-2xl">
                      {slide.text}
                    </p>
                  </div>
                </div>
              )}
            </div>
          </div>
        </Carousel.Item>
      ))}
    </Carousel.Inner>
    <Carousel.Controls id={carouselId} style="pointer-events: auto;" />
  </Carousel>
</div>

<script define:vars={{ carouselId }}>
  // Prevent body scrolling when essay is open
  document.body.style.overflow = 'hidden';
  
  const carouselElement = document.getElementById(carouselId);
  const backButton = document.getElementById('essay-back-button');
  
  // Close function
  function closeEssay() {
    if (backButton) {
      window.location.href = '/essays';
    }
  }
  
  if (carouselElement) {
    // Keyboard navigation - only arrow keys and escape
    document.addEventListener('keydown', (e) => {
      if (e.key === 'ArrowRight') {
        const carousel = bootstrap.Carousel.getInstance(carouselElement);
        if (carousel) {
          e.preventDefault();
          carousel.next();
        }
      } else if (e.key === 'ArrowLeft') {
        const carousel = bootstrap.Carousel.getInstance(carouselElement);
        if (carousel) {
          e.preventDefault();
          carousel.prev();
        }
      } else if (e.key === 'Escape') {
        // Exit on Escape key
        closeEssay();
      }
    });
  }
  
  // Cleanup on page unload
  window.addEventListener('beforeunload', () => {
    document.body.style.overflow = '';
  });
</script>
